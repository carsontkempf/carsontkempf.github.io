---
title: Dashboard
---

<!DOCTYPE html>
<html lang="en-US">
  {% include widgets/header/head.html %}
  <body>
    <aside class="sidebar">
      {% include widgets/sidebar/sidebar.html %}
    </aside>

    {% include components/ui/sidebar-toggle.html %}

    <div class="page-content">
      <header class="header">
        {% include widgets/header/main.html %}
      </header>
      
      <div class="wrapper">
        <main class="main-content">
          <!-- Dashboard-specific content wrapper -->
          <div class="dashboard-container">
            <div class="dashboard-header">
              <h1>{{ page.title | default: "Dashboard" }}</h1>
              <nav class="dashboard-nav">
                <a href="{{ '/' | relative_url }}" class="nav-link">Home</a>
                <button id="logout-btn" class="nav-link logout-btn">Logout</button>
              </nav>
            </div>
            
            <div class="dashboard-main-content">
              <h2>Welcome to your Dashboard!</h2>
              <p>This page is only visible to authenticated users.</p>
              <div id="dashboard-content">
                  <p>Loading dashboard data...</p>
              </div>

              <!-- This is where content from the page using this layout will be injected -->
              {{ content }}
            </div>
          </div>
        </main>
        <footer class="footer">
          {% include widgets/footer/footer.html %}
        </footer>
      </div>
    </div>

    <!-- Load Auth0 SPA SDK -->
    <script defer src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
    
    <!-- MusicKit JS for Apple Music integration -->
    <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js" defer></script>
    
    <script src="{{ '/assets/js/env-config.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/auth.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/google-drive-service.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/google-picker-service.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/folder-debug-service.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/annotation-drive-service.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/apple-music-service.js' | relative_url }}"></script>

    <!-- Dashboard functionality script -->
    <script>
      document.addEventListener('DOMContentLoaded', async () => {
          console.log('[Dashboard Layout Script] Page loaded. Checking auth status via siteAuth.');
      
          function waitForSiteAuthData() {
              return new Promise((resolve, reject) => {
                  const timeout = setTimeout(() => {
                      document.removeEventListener('siteAuthReady', listener);
                      console.error('[Dashboard Layout Script] Timeout! siteAuthReady event not received.');
                      reject(new Error("siteAuthReady event timed out."));
                  }, 7000);
                  const listener = (event) => {
                      clearTimeout(timeout);
                      document.removeEventListener('siteAuthReady', listener);
                      console.log('[Dashboard Layout Script] siteAuthReady event received.');
                      resolve(event.detail);
                  };
                  document.addEventListener('siteAuthReady', listener);
                  if (window.siteAuth && typeof window.siteAuth.isAuthenticated === 'boolean' && window.siteAuth.auth0Client) {
                     console.log('[Dashboard Layout Script] siteAuth seems ready, attempting to resolve without event.');
                     listener({ detail: window.siteAuth });
                  }
              });
          }
      
          try {
              const siteAuth = await waitForSiteAuthData();
      
              if (siteAuth.isAuthenticated) {
                  console.log('[Dashboard Layout Script] User is authenticated. Proceeding to load dashboard content.');
                  const dashboardContentEl = document.getElementById('dashboard-content');
                  if (dashboardContentEl) {
                    dashboardContentEl.innerHTML = `
                        <p>Hello, ${siteAuth.user ? siteAuth.user.name : 'User'}!</p>
                        <p>Your access token starts with: ${siteAuth.accessToken ? siteAuth.accessToken.substring(0, 20) + '...' : 'No token available'}</p>
                        <p>You can add subscriber-only content here.</p>
                    `;
                  }
              } else {
                  console.warn('[Dashboard Layout Script] User is NOT authenticated. This should have been handled by global redirect.');
                  const dashboardContentEl = document.getElementById('dashboard-content');
                  if (dashboardContentEl) {
                    dashboardContentEl.innerHTML = "<p>Access Denied. You should be redirected to login shortly. If not, please <a href='{{ '/' | relative_url }}'>click here to go home</a>.</p>";
                  }
              }
          } catch (error) {
              console.error('[Dashboard Layout Script] Error initializing dashboard:', error);
              const dashboardContentEl = document.getElementById('dashboard-content');
              if (dashboardContentEl) {
                dashboardContentEl.innerHTML = `<p>Error loading dashboard: ${error.message}</p>`;
              }
          }
      });

      // Add logout functionality when DOM is ready
      document.addEventListener('DOMContentLoaded', () => {
          const logoutBtn = document.getElementById('logout-btn');
          if (logoutBtn) {
              logoutBtn.addEventListener('click', async () => {
                  console.log('[Dashboard] Logout button clicked');
                  if (window.siteAuth && window.siteAuth.auth0Client) {
                      try {
                          await window.siteAuth.auth0Client.logout({
                              logoutParams: {
                                  returnTo: window.location.origin
                              }
                          });
                      } catch (error) {
                          console.error('[Dashboard] Error during logout:', error);
                      }
                  } else {
                      console.warn('[Dashboard] No auth client available for logout');
                      window.location.href = '{{ "/" | relative_url }}';
                  }
              });
          }
      });
    </script>
  </body>
</html>