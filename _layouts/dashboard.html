---
layout: default
title: Dashboard
permalink: /dashboard/
---

<div id="dashboard-content-wrapper" style="display: none;">
  
  <header class="dashboard-header">
    <h1>{{ page.title }}</h1>
    <div id="user-profile-details"></div> 
  </header>

  <main class="dashboard-main-content">
    <div class="dashboard-buttons">
      <a href="{{ '/spotify-apple/' | relative_url }}" class="dashboard-btn">Spotify Apple Integration</a>
      <div id="auth-management-buttons">
        <!-- Buttons will be dynamically loaded based on user permissions -->
      </div>
    </div>
    </main>
</div>

<div id="dashboard-login-prompt" style="display: none;">
    <h2>Access Denied</h2>
    <p>You must be logged in to view this page.</p>
    <button onclick="authService.login()" class="login-btn">Log In</button>
</div>

<script>
    document.addEventListener('authReady', () => {
        if (window.authService.isAuthenticated) {
            document.getElementById('dashboard-content-wrapper').style.display = 'block';
            
            const user = window.authService.user;
            const profileDiv = document.getElementById('user-profile-details');
            
            if (user && profileDiv) {
                // This injects HTML with the correct classes to match our CSS
                profileDiv.innerHTML = `
                    <p class="welcome-message">Welcome, ${user.name}!</p>
                    <p class="login-status">Your login status is confirmed.</p>
                `;
            }
            
            // Load appropriate buttons based on user permissions
            loadDashboardButtons(user);
        } else {
            document.getElementById('dashboard-login-prompt').style.display = 'block';
        }
    });

    function loadDashboardButtons(user) {
        const authButtonsDiv = document.getElementById('auth-management-buttons');
        
        // Check user roles in multiple possible locations
        const customRoles = user['https://carsontkempf.github.io/roles'] || [];
        const auth0Roles = user['https://auth0.com/roles'] || [];
        const appMetadataRoles = user.app_metadata?.roles || [];
        const userMetadataRoles = user.user_metadata?.roles || [];
        
        // Combine all possible role sources
        const allRoles = [...customRoles, ...auth0Roles, ...appMetadataRoles, ...userMetadataRoles];
        
        const hasAdminRole = allRoles.includes('admin');
        const hasCodeComprehensionRole = allRoles.includes('Code-Comprehension-Project') || 
                                        allRoles.includes('rol_XUUh9ZOhirY2yCQQ');
        const isSiteOwner = user.email === 'ctkfdp@umsystem.edu';
        
        if (hasAdminRole || isSiteOwner) {
            // Full admin access - show both buttons
            authButtonsDiv.innerHTML = `
                <a href="{{ '/auth0-users/' | relative_url }}" class="dashboard-btn">Auth0 User Management</a>
                <a href="{{ '/code-comprehension/' | relative_url }}" class="dashboard-btn">Code Comprehension Project</a>
            `;
        } else if (hasCodeComprehensionRole) {
            // Limited access - only show Code Comprehension Project
            authButtonsDiv.innerHTML = `
                <a href="{{ '/code-comprehension/' | relative_url }}" class="dashboard-btn">Code Comprehension Project</a>
            `;
        }
        // If user has no special roles, no additional buttons are shown
    }
</script>